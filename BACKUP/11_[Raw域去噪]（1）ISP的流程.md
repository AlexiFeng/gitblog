# [[Raw域去噪]（1）ISP的流程](https://github.com/AlexiFeng/gitblog/issues/11)

在SIAT做了一个AI-ISP的项目，我负责的是raw域的去噪，与我们常见的ai算法不同，它是直接作用于相机原始数据的。更偏底层，在做的过程中也对ISP有了一点了解。在这里写下一个入门笔记，仅供参考。

---

从宏观角度来讲，我们看到的照片通常经历了如下一个流程：光通过镜头打到CMOS传感器上，得到原始数据（Bayer Mosaic）-》Demosaic-》白平衡，Gamma校正...
> 这个地方我特意提到了光打到CMOS传感器上，因为这也是radiation noise形成的主要原因，这是我后面要做的项目。

而raw格式文件通常是照片的原始文件，就是Bayer Mosaic的，可以简单理解为它并不是以RGB格式存储的，而是以RGGB/BGGR/RGBG...等方式进行存储的。而demosaic就是将其转换成RGB/BGR格式的图像，往往就是取G的均值进行处理。从这也可以看出，如果使用了与原图不匹配的demosaic方法将会转出很奇怪的结果，轻则颜色错误，重则全是马赛克。

---
做AIISP的时候遇到的场景。自己采集的数据没有数据头，没法用rawpy读取。numpy读取raw然后使用opencv做demosaic 。
虽然raw的位数有很多种，但是处理起来其实很简单。以8位和10位图像为例。raw8是指8位图像[0,255)，而raw10是指10位图像[0-1024)
如果想把8位转成10位最简单的处理方法就是直接扩大位数，raw8*2^2即可。而10位转8位只需要/4就可以。
其实这个操作我觉得很像normalize之后再还原回去。
附上一个参考代码

另外demosaic之后的图片通常需要转成8位才能使用opencv之类的库直接显示图像。